<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Arabic Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const socket = io("http://localhost:3000");

      async function postWords() {
        const wordsInput = document.getElementById("words").value;
        const wordsArray = wordsInput.split(",").map((word) => word.trim());

        if (wordsArray.length === 0 || wordsArray[0] === "") {
          alert("Please enter words!");
          return;
        }

        await fetch("http://localhost:3000/post-words", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ words: wordsArray }),
        });

        alert("Words posted successfully!");
        document.getElementById("words").value = "";
      }

      async function clearTest() {
        await fetch("http://localhost:3000/clear", { method: "POST" });
        alert("Test cleared!");
        document.getElementById("resultsContainer").innerHTML = ""; // Clear results
      }

      async function fetchResults() {
        let response = await fetch("http://localhost:3000/get-results");
        let data = await response.json();

        let responseWords = await fetch("http://localhost:3000/get-words");
        let wordData = await responseWords.json();

        let words = wordData.words || []; // Fetch Arabic words
        let resultsContainer = document.getElementById("resultsContainer");
        resultsContainer.innerHTML = ""; // Clear previous results

        for (let user in data) {
          let userAnswers = data[user] || [];

          // Create a section for each user
          let userSection = document.createElement("div");
          userSection.className =
            "bg-white p-4 rounded-lg shadow-md mt-6 w-full";

          // Display user's name at the top
          userSection.innerHTML = `
                <h3 class="text-xl font-bold text-gray-700 mb-2">${user}'s Results</h3>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="border border-gray-400 px-4 py-2">Arabic Word</th>
                            <th class="border border-gray-400 px-4 py-2">Answer</th>
                        </tr>
                    </thead>
                    <tbody id="table-${user}"></tbody>
                </table>
            `;

          resultsContainer.appendChild(userSection); // Add section to the page
          let userTable = document.getElementById(`table-${user}`);

          // Loop through Arabic words and correctly map answers
          words.forEach((word, index) => {
            let userAnswer =
              userAnswers.length > index ? userAnswers[index] : "-"; // Ensure mapping is correct
            let row = `
                    <tr>
                        <td class="border border-gray-400 px-4 py-2 text-right text-2xl font-bold text-blue-600">${word}</td>
                        <td class="border border-gray-400 px-4 py-2">${userAnswer}</td>
                    </tr>
                `;
            userTable.innerHTML += row;
          });
        }
      }
    </script>
    <style>
        @font-face {
          font-family: 'IndoPakAsia';
          src: url('./fonts/IndoPakAsia-Regular.ttf') format('truetype');
          font-weight: normal;
          font-style: normal;
        }
      
        /* Apply this font for Arabic text */
        .arabic-text {
          font-family: 'IndoPakAsia', sans-serif;
        }
      </style>
  </head>
  <body class="bg-zinc-500 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center w-1/2 mt-4">
      <h1 class="text-3xl font-bold mb-4 text-blue-800">Admin Panel</h1>

      <textarea
        id="words"
        class="w-full p-3 border rounded-lg"
        placeholder="Enter Arabic words, separated by commas"
      ></textarea>
      <div class="flex justify-center gap-4 mt-4">
        <button
          class="bg-blue-500 text-white px-4 py-2 rounded-lg"
          onclick="postWords()"
        >
          Post Words
        </button>
        <button
          class="bg-red-500 text-white px-4 py-2 rounded-lg"
          onclick="clearTest()"
        >
          Clear Test
        </button>
        <button
          class="bg-green-500 text-white px-4 py-2 rounded-lg"
          onclick="fetchResults()"
        >
          Show Results
        </button>
      </div>

      <div id="resultsContainer" class="mt-6 arabic-text"></div>
    </div>
  </body>
</html>
